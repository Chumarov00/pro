<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>MindAR Fixation Final</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/loaders/GLTFLoader.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #ar-container { width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; }
      #fix-button {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
        padding: 12px 24px;
        font-size: 18px;
        background-color: rgba(255, 255, 255, 0.9);
        border: 2px solid #333;
        border-radius: 10px;
        cursor: pointer;
      }
      #fix-button:active {
        background-color: #ccc;
      }
    </style>
  </head>
  <body>
    <div id="ar-container">
      <button id="fix-button">üìå –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å</button>
      <a-scene 
        mindar-image="imageTargetSrc: https://chumarov00.github.io/pro/targets.mind;" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: true"
        embedded
        renderer="colorManagement: true, physicallyCorrectLights: true">
        
        <a-assets></a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity id="marker" mindar-image-target="targetIndex: 0">
          <a-entity id="model-anchor"></a-entity>
        </a-entity>
      </a-scene>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const scene = document.querySelector("a-scene").object3D;
        const marker = document.getElementById("marker");
        const modelAnchor = document.getElementById("model-anchor").object3D;
        const button = document.getElementById("fix-button");

        const loader = new THREE.GLTFLoader();
        let gltfModel = null;
        let fixed = false;

        loader.load("https://chumarov00.github.io/pro/model.glb", (gltf) => {
          gltfModel = gltf.scene;
          gltfModel.scale.set(0.2, 0.2, 0.2);
          modelAnchor.add(gltfModel.clone()); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ –º–∞—Ä–∫–µ—Ä–µ
        });

        button.addEventListener("click", () => {
          if (fixed || !gltfModel) return;
          fixed = true;

          // –ü–æ–ª—É—á–∞–µ–º –º–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —è–∫–æ—Ä—è
          const worldPos = new THREE.Vector3();
          const worldQuat = new THREE.Quaternion();
          modelAnchor.getWorldPosition(worldPos);
          modelAnchor.getWorldQuaternion(worldQuat);

          // –ö–ª–æ–Ω–∏—Ä—É–µ–º –º–æ–¥–µ–ª—å –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ —Å—Ü–µ–Ω—É
          const fixedModel = gltfModel.clone(true);
          fixedModel.position.copy(worldPos);
          fixedModel.quaternion.copy(worldQuat);
          fixedModel.scale.set(0.2, 0.2, 0.2);
          scene.add(fixedModel);

          // –û—Ç–∫–ª—é—á–∞–µ–º –º–∞—Ä–∫–µ—Ä
          marker.setAttribute("visible", "false");
        });
      });
    </script>
  </body>
</html>
