<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>WebAR —Å —Ñ–∏–∫—Å–∞—Ü–∏–µ–π</title>

    <!-- A-Frame + MindAR -->
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.5.0/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.7/dist/mindar-image-aframe.prod.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #fixButton {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        font-size: 16px;
        z-index: 10;
      }
    </style>
  </head>

  <body>
    <button id="fixButton">üîí –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å</button>

    <a-scene mindar-image="imageTargetSrc: ./targets.mind;" 
             color-space="sRGB" 
             embedded 
             renderer="colorManagement: true, physicallyCorrectLights"
             vr-mode-ui="enabled: false"
             device-orientation-permission-ui="enabled: true">
             
      <!-- –ö–∞–º–µ—Ä–∞ —Å AR -->
      <a-camera position="0 0 0" look-controls enabled="false" 
                mindar-camera></a-camera>

      <!-- –°–ª–æ–π –¥–ª—è –º–∞—Ä–∫–µ—Ä–∞ -->
      <a-entity mindar-image-target="targetIndex: 0">
        <a-entity id="model" 
                  gltf-model="./model.glb" 
                  scale="0.3 0.3 0.3" 
                  position="0 0 0" 
                  rotation="0 0 0">
        </a-entity>
      </a-entity>

      <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ -->
      <a-entity id="fixedModel" visible="false"></a-entity>
    </a-scene>

    <script>
      const fixButton = document.getElementById('fixButton');
      const originalModel = document.querySelector('#model');
      const fixedModel = document.querySelector('#fixedModel');

      fixButton.addEventListener('click', () => {
        // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∏ –≤—Ä–∞—â–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏
        const position = originalModel.object3D.getWorldPosition(new THREE.Vector3());
        const rotation = originalModel.object3D.getWorldRotation(new THREE.Euler());

        // –ö–ª–æ–Ω–∏—Ä—É–µ–º –º–æ–¥–µ–ª—å –∏ —Ä–∞–∑–º–µ—â–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–æ–ø–∏—é
        const newEntity = document.createElement('a-entity');
        newEntity.setAttribute('gltf-model', './model.glb');
        newEntity.setAttribute('scale', '0.3 0.3 0.3');
        newEntity.setAttribute('position', `${position.x} ${position.y} ${position.z}`);
        newEntity.setAttribute('rotation', `${THREE.Math.radToDeg(rotation.x)} ${THREE.Math.radToDeg(rotation.y)} ${THREE.Math.radToDeg(rotation.z)}`);

        fixedModel.appendChild(newEntity);
        fixedModel.setAttribute('visible', 'true');

        // –°–∫—Ä—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª (–ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫ –º–∞—Ä–∫–µ—Ä—É)
        originalModel.setAttribute('visible', 'false');

        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        fixButton.style.display = 'none';
      });
    </script>
  </body>
</html>
