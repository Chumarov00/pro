<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>MindAR Fixation</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #ar-container { width: 100vw; height: 100vh; position: fixed; top: 0; left: 0; }
      #fix-button {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
        padding: 12px 24px;
        font-size: 18px;
        background-color: rgba(255, 255, 255, 0.8);
        border: 2px solid #333;
        border-radius: 10px;
        cursor: pointer;
        user-select: none;
      }
      #fix-button:active {
        background-color: #ccc;
      }
    </style>
  </head>
  <body>
    <div id="ar-container">
      <button id="fix-button">üìå –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å</button>
      <a-scene 
        mindar-image="imageTargetSrc: https://chumarov00.github.io/pro/targets.mind;" 
        vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: true"
        embedded
        renderer="colorManagement: true, physicallyCorrectLights: true">
        
        <a-assets>
          <a-asset-item id="model" src="https://chumarov00.github.io/pro/model.glb"></a-asset-item>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <!-- –ú–µ—Å—Ç–æ –¥–ª—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ -->
        <a-entity id="fixed-model-container"></a-entity>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–¥–µ–ª–∏, –ø–æ–∫–∞ –æ–Ω–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ –º–∞—Ä–∫–µ—Ä—É -->
        <a-entity id="marker-target" mindar-image-target="targetIndex: 0">
          <a-gltf-model 
            id="tracking-model"
            src="#model" 
            position="0 0 0" 
            rotation="0 0 0" 
            scale="0.2 0.2 0.2">
          </a-gltf-model>
        </a-entity>
      </a-scene>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const fixButton = document.getElementById("fix-button");
        const scene = document.querySelector("a-scene");
        const marker = document.getElementById("marker-target");
        const trackingModel = document.getElementById("tracking-model");
        const fixedContainer = document.getElementById("fixed-model-container");

        let fixed = false;

        fixButton.addEventListener("click", () => {
          if (fixed) return;
          fixed = true;

          // –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∏ –ø–æ–≤–æ—Ä–æ—Ç –∏–∑ –º–∏—Ä–∞
          const worldPos = new THREE.Vector3();
          const worldQuat = new THREE.Quaternion();
          trackingModel.object3D.getWorldPosition(worldPos);
          trackingModel.object3D.getWorldQuaternion(worldQuat);

          // –°–æ–∑–¥–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–æ–¥–µ–ª—å
          const fixedModel = document.createElement("a-gltf-model");
          fixedModel.setAttribute("src", "#model");
          fixedModel.setAttribute("scale", "0.2 0.2 0.2");

          // –ù–∞–∑–Ω–∞—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∏ –ø–æ–≤–æ—Ä–æ—Ç
          fixedModel.object3D.position.copy(worldPos);
          fixedModel.object3D.quaternion.copy(worldQuat);

          // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å—Ü–µ–Ω—É
          fixedContainer.appendChild(fixedModel);

          // –°–∫—Ä—ã–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä –∏ —Ç—Ä–µ–∫–∏–Ω–≥–æ–≤—É—é –º–æ–¥–µ–ª—å
          marker.setAttribute("visible", "false");
        });
      });
    </script>
  </body>
</html>
