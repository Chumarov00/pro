<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>MindAR + —Ñ–∏–∫—Å–∞—Ü–∏—è –º–æ–¥–µ–ª–∏12</title>

    <!-- A-Frame –∏ MindAR -->
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <style>
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: black;
      }

      a-scene {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
      }

      #fix-button {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 12px 24px;
        font-size: 16px;
        background: #2196f3;
        color: white;
        border: none;
        border-radius: 8px;
        z-index: 100;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <button id="fix-button">üìå –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å</button>

    <a-scene
      mindar-image="imageTargetSrc: https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/image-tracking/assets/card-example/card.mind"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: true"
      embedded
      renderer="colorManagement: true; logarithmicDepthBuffer: true;"
    >
      <a-assets>
        <!-- –ú–æ–∂–µ—à—å –∑–∞–º–µ–Ω–∏—Ç—å cube.glb –Ω–∞ —Å–≤–æ—é –º–æ–¥–µ–ª—å -->
        <a-asset-item id="model" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/image-tracking/assets/toy-block/toy-block.glb"></a-asset-item>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <a-entity mindar-image-target="targetIndex: 0">
        <a-entity
          id="model-root"
          gltf-model="#model"
          position="0 0 0"
          scale="0.5 0.5 0.5"
          visible="false"
        ></a-entity>
      </a-entity>
    </a-scene>

    <script>
      const sceneEl = document.querySelector('a-scene');
      const model = document.querySelector('#model-root');
      const fixBtn = document.querySelector('#fix-button');

      let isFixed = false;
      let fixedPosition = null;
      let fixedRotation = null;

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–µ–ª—å –ø—Ä–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ –º–∞—Ä–∫–µ—Ä–∞
      sceneEl.addEventListener('targetFound', () => {
        if (!isFixed) {
          model.setAttribute('visible', 'true');
        }
      });

      // –°–∫—Ä—ã–≤–∞–µ–º, –µ—Å–ª–∏ –º–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω
      sceneEl.addEventListener('targetLost', () => {
        if (!isFixed) {
          model.setAttribute('visible', 'false');
        }
      });

      fixBtn.addEventListener('click', () => {
        if (!isFixed) {
          fixedPosition = model.object3D.position.clone();
          fixedRotation = model.object3D.rotation.clone();
          isFixed = true;

          // –û—Ç–∫–ª—é—á–∞–µ–º —Ä–æ–¥–∏—Ç–µ–ª—è-–º–∞—Ä–∫–µ—Ä–∞ (—á—Ç–æ–±—ã –º–æ–¥–µ–ª—å –Ω–µ –ø—Ä–æ–ø–∞–¥–∞–ª–∞)
          const parent = model.parentElement;
          parent.removeChild(model);
          sceneEl.appendChild(model);

          model.object3D.position.copy(fixedPosition);
          model.object3D.rotation.copy(fixedRotation);
          model.setAttribute('visible', 'true');

          fixBtn.innerText = '‚úÖ –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ';
          fixBtn.style.background = '#4caf50';
        }
      });
    </script>
  </body>
</html>
